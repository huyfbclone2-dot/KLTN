PS E:\IDS> python train_cicids_zeek.py  --train_csv out/train_clean.csv  --test_csv  out/test.csv   --outdir    runs/exp1  --epochs    40  --batch     4096 
2025-10-24 11:38:18.840749: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors 
from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2025-10-24 11:38:22.625931: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors 
from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2025-10-24 11:38:34.708934: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: SSE3 SSE4.1 SSE4.2 AVX, in other operations, rebuild TensorFlow with the appropriate compiler flags.
Epoch 1/40
140/140 - 44s - 315ms/step - auc: 0.9912 - binary_accuracy: 0.9637 - loss: 0.1016 - val_auc: 0.9977 - val_binary_accuracy: 0.9923 - val_loss: 0.0331 - learning_rate: 1.0000e-03
Epoch 2/40
140/140 - 41s - 296ms/step - auc: 0.9982 - binary_accuracy: 0.9912 - loss: 0.0298 - val_auc: 0.9983 - val_binary_accuracy: 0.9914 - val_loss: 0.0309 - learning_rate: 1.0000e-03
Epoch 3/40
140/140 - 47s - 337ms/step - auc: 0.9989 - binary_accuracy: 0.9928 - loss: 0.0234 - val_auc: 0.9989 - val_binary_accuracy: 0.9928 - val_loss: 0.0227 - learning_rate: 1.0000e-03
Epoch 4/40
140/140 - 52s - 371ms/step - auc: 0.9991 - binary_accuracy: 0.9935 - loss: 0.0206 - val_auc: 0.9991 - val_binary_accuracy: 0.9921 - val_loss: 0.0192 - learning_rate: 1.0000e-03
Epoch 5/40
140/140 - 55s - 395ms/step - auc: 0.9992 - binary_accuracy: 0.9938 - loss: 0.0193 - val_auc: 0.9990 - val_binary_accuracy: 0.9945 - val_loss: 0.0179 - learning_rate: 1.0000e-03
Epoch 6/40
140/140 - 54s - 389ms/step - auc: 0.9992 - binary_accuracy: 0.9938 - loss: 0.0188 - val_auc: 0.9992 - val_binary_accuracy: 0.9946 - val_loss: 0.0180 - learning_rate: 1.0000e-03
Epoch 7/40

Epoch 7: ReduceLROnPlateau reducing learning rate to 0.0005000000237487257.
140/140 - 56s - 398ms/step - auc: 0.9993 - binary_accuracy: 0.9942 - loss: 0.0175 - val_auc: 0.9993 - val_binary_accuracy: 0.9933 - val_loss: 0.0174 - learning_rate: 1.0000e-03
Epoch 8/40
140/140 - 58s - 416ms/step - auc: 0.9994 - binary_accuracy: 0.9945 - loss: 0.0166 - val_auc: 0.9994 - val_binary_accuracy: 0.9952 - val_loss: 0.0160 - learning_rate: 5.0000e-04
Epoch 9/40
140/140 - 58s - 413ms/step - auc: 0.9994 - binary_accuracy: 0.9945 - loss: 0.0165 - val_auc: 0.9994 - val_binary_accuracy: 0.9952 - val_loss: 0.0164 - learning_rate: 5.0000e-04
Epoch 10/40

Epoch 10: ReduceLROnPlateau reducing learning rate to 0.0002500000118743628.
140/140 - 58s - 411ms/step - auc: 0.9994 - binary_accuracy: 0.9946 - loss: 0.0161 - val_auc: 0.9994 - val_binary_accuracy: 0.9950 - val_loss: 0.0161 - learning_rate: 5.0000e-04
Epoch 11/40
140/140 - 58s - 412ms/step - auc: 0.9995 - binary_accuracy: 0.9947 - loss: 0.0156 - val_auc: 0.9994 - val_binary_accuracy: 0.9953 - val_loss: 0.0160 - learning_rate: 2.5000e-04
Epoch 12/40
140/140 - 60s - 427ms/step - auc: 0.9995 - binary_accuracy: 0.9947 - loss: 0.0156 - val_auc: 0.9994 - val_binary_accuracy: 0.9954 - val_loss: 0.0153 - learning_rate: 2.5000e-04
Epoch 13/40
140/140 - 60s - 432ms/step - auc: 0.9995 - binary_accuracy: 0.9948 - loss: 0.0155 - val_auc: 0.9995 - val_binary_accuracy: 0.9954 - val_loss: 0.0156 - learning_rate: 2.5000e-04
Epoch 14/40

Epoch 14: ReduceLROnPlateau reducing learning rate to 0.0001250000059371814.
140/140 - 62s - 446ms/step - auc: 0.9995 - binary_accuracy: 0.9948 - loss: 0.0154 - val_auc: 0.9995 - val_binary_accuracy: 0.9953 - val_loss: 0.0157 - learning_rate: 2.5000e-04
Epoch 15/40
140/140 - 60s - 429ms/step - auc: 0.9995 - binary_accuracy: 0.9949 - loss: 0.0151 - val_auc: 0.9995 - val_binary_accuracy: 0.9953 - val_loss: 0.0159 - learning_rate: 1.2500e-04
Epoch 16/40

Epoch 16: ReduceLROnPlateau reducing learning rate to 6.25000029685907e-05.
140/140 - 61s - 435ms/step - auc: 0.9995 - binary_accuracy: 0.9949 - loss: 0.0151 - val_auc: 0.9995 - val_binary_accuracy: 0.9954 - val_loss: 0.0152 - learning_rate: 1.2500e-04
Epoch 17/40
140/140 - 63s - 448ms/step - auc: 0.9995 - binary_accuracy: 0.9949 - loss: 0.0149 - val_auc: 0.9995 - val_binary_accuracy: 0.9955 - val_loss: 0.0151 - learning_rate: 6.2500e-05
ACC@0.5 TRAIN: 0.9949234307511079
ACC@0.5 VAL  : 0.9953932237617098
[Maximin] thr=0.601031  TRAIN acc=0.9949  VAL acc=0.9954
WARNING:absl:`id.resp_p` is not a valid tf.function parameter name. Sanitizing to `id_resp_p`.
WARNING:absl:`id.resp_p` is not a valid tf.function parameter name. Sanitizing to `id_resp_p`.
WARNING:absl:`id.resp_p` is not a valid tf.function parameter name. Sanitizing to `id_resp_p`.
WARNING:absl:`id.resp_p` is not a valid tf.function parameter name. Sanitizing to `id_resp_p`.
WARNING:absl:`id.resp_p` is not a valid tf.function parameter name. Sanitizing to `id_resp_p`.
Saved artifact at 'runs/exp1\saved_model'. The following endpoints are available:

* Endpoint 'serve'
  args_0 (POSITIONAL_ONLY): Dict[['id.resp_p', TensorSpec(shape=(None, 1), dtype=tf.float32, name='id.resp_p')], ['duration', TensorSpec(shape=(None, 1), dtype=tf.float32, name='duration')], ['orig_bytes', TensorSpec(shape=(None, 1), dtype=tf.float32, name='orig_bytes')], ['resp_bytes', TensorSpec(shape=(None, 1), dtype=tf.float32, name='resp_bytes')], ['orig_pkts', TensorSpec(shape=(None, 1), dtype=tf.float32, name='orig_pkts')], ['resp_pkts', TensorSpec(shape=(None, 1), dtype=tf.float32, name='resp_pkts')], ['total_bytes', TensorSpec(shape=(None, 
1), dtype=tf.float32, name='total_bytes')], ['total_pkts', TensorSpec(shape=(None, 1), dtype=tf.float32, name='total_pkts')], ['byte_ratio', TensorSpec(shape=(None, 1), dtype=tf.float32, name='byte_ratio')], ['pkt_ratio', TensorSpec(shape=(None, 1), dtype=tf.float32, name='pkt_ratio')], ['bytes_per_pkt', TensorSpec(shape=(None, 1), dtype=tf.float32, name='bytes_per_pkt')], ['pkts_per_sec', TensorSpec(shape=(None, 1), dtype=tf.float32, name='pkts_per_sec')], ['bytes_per_sec', TensorSpec(shape=(None, 1), dtype=tf.float32, name='bytes_per_sec')], ['log_total_bytes', TensorSpec(shape=(None, 1), dtype=tf.float32, name='log_total_bytes')], ['log_total_pkts', TensorSpec(shape=(None, 1), dtype=tf.float32, name='log_total_pkts')], ['log_bytes_per_pkt', TensorSpec(shape=(None, 1), dtype=tf.float32, name='log_bytes_per_pkt')], ['log_pkts_per_sec', TensorSpec(shape=(None, 1), dtype=tf.float32, name='log_pkts_per_sec')], ['log_bytes_per_sec', TensorSpec(shape=(None, 1), dtype=tf.float32, name='log_bytes_per_sec')], ['proto', TensorSpec(shape=(None,), dtype=tf.string, name='proto')], ['resp_port_bucket', TensorSpec(shape=(None,), dtype=tf.string, name='resp_port_bucket')]]
Output Type:
  TensorSpec(shape=(None, 1), dtype=tf.float32, name=None)
Captures:
  2780859335120: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859336848: TensorSpec(shape=(), dtype=tf.int64, name=None)
  2780859335312: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859071952: TensorSpec(shape=(), dtype=tf.int64, name=None)
  2780859334928: TensorSpec(shape=(1, 18), dtype=tf.float32, name=None)
  2780859334736: TensorSpec(shape=(1, 18), dtype=tf.float32, name=None)
  2780859335888: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859336080: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859336464: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859338192: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859336272: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859335696: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859337616: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859337808: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859337424: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859339728: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859338576: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859339536: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859338768: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859340304: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859338384: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859337040: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859340112: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859338960: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859340880: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859341840: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859341648: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859342416: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859341456: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859340688: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859341072: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859341264: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859342800: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859343760: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859343568: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859344336: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859342224: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859342032: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859344144: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859343376: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859344912: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859345872: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859345680: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859344912: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859345872: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859345680: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859345872: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859345680: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859345680: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859346448: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859346448: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859345488: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859344720: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859345104: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859345488: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859344720: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859345104: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859344720: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859345104: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859345296: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859345296: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859346640: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859347600: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859346640: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859347600: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859347600: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859347408: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859347408: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859347984: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859347792: TensorSpec(shape=(), dtype=tf.resource, name=None)
  2780859348368: TensorSpec(shape=(), dtype=tf.resource, name=None)
== Tuned accuracies ==
TRAIN acc: 0.9949
VAL   acc: 0.9954
TEST  acc: 0.9951
Artifacts in: runs/exp1
                precision    recall  f1-score   support

           0     0.9959    0.9974    0.9967     56465
           1     0.9927    0.9885    0.9906     20110

    accuracy                         0.9951     76575
   macro avg     0.9943    0.9930    0.9936     76575
weighted avg     0.9951    0.9951    0.9951     76575


PS E:\IDS> python turning.py --model runs/exp1_ft1/model.keras --finetune_csv mixed_portscan.csv --outdir runs/exp1_ps_ft --epochs 2 --val_split 0.1 --batch 8192 --lr 3e-4
2025-10-24 13:07:00.301410: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors 
from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2025-10-24 13:07:04.778971: I tensorflow/core/util/port.cc:153] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors 
from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
[INFO] Loading model: runs/exp1_ft1/model.keras
2025-10-24 13:07:07.861049: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: SSE3 SSE4.1 SSE4.2 AVX, in other operations, rebuild TensorFlow with the appropriate compiler flags.
[WARN] Could not set model LR; continuing with existing LR
[INFO] Loading batch: mixed_portscan.csv
[INFO] Supervised fine-tune with 441006 labeled rows.
[INFO] Starting fine-tune...
Epoch 1/2
49/49 - 28s - 568ms/step - auc: 0.9997 - binary_accuracy: 0.9967 - loss: 0.0101 - val_auc: 0.9911 - val_binary_accuracy: 0.9637 - val_loss: 0.1236 - learning_rate: 6.2500e-05
Epoch 2/2
49/49 - 22s - 457ms/step - auc: 0.9997 - binary_accuracy: 0.9997 - loss: 0.0020 - val_auc: 0.9912 - val_binary_accuracy: 0.9637 - val_loss: 0.1236 - learning_rate: 6.2500e-05
[OK] Saved updated model to: runs\exp1_ps_ft\model.keras
              precision    recall  f1-score   support

           0     0.9999    0.9826    0.9912     37544
           1     0.9095    0.9994    0.9523      6557

    accuracy                         0.9851     44101
   macro avg     0.9547    0.9910    0.9718     44101
weighted avg     0.9865    0.9851    0.9854     44101

